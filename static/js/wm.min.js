(function(){"use strict";function t(t,e){return document.currentScript.getAttribute("data-"+t)||e}function e(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&quot;")}function o(t){const o=e(t.author&&t.author.name?t.author.name:t.url.split("/")[2]),n=b[t["wm-property"]]||"reacted";let r='<a class="reaction" rel="nofollow ugc" title="'+o+" "+n+'" href="'+t[m]+'">';return t.author&&t.author.photo&&(r+='<img class="webmention__author__img" src="'+e(t.author.photo)+'">'),r+=g[t["wm-property"]]||"💥",t.rsvp&&v[t.rsvp]&&(r+="<sub>"+v[t.rsvp]+"</sub>"),r+="</a>",r}function n(t){const e=new Date(t),o=e.toString(),n='<span class="webmention__date">'+o.substr(3,12)+"</span>";return n}function r(t){return t.substr(t.indexOf("//"))}function i(t){const e=[],o={};return t.forEach(function(t){const n=r(t.url);o[n]||(e.push(t),o[n]=!0)}),e}function s(t){let r='<ul class="comments">';return t.forEach(function(t){let i,s;if(r+='<li><div class="webmention">',r+='<div class="webmention__properties"><a class="source" rel="nofollow ugc" href="'+t[m]+'">',t.author&&t.author.name?r+=e(t.author.name):r+=e(t.url.split("/")[2]),r+="</a> "+o(t)+" "+n(t.published)+"</div>",t.content&&t.content.text){let o=e(t.content.text);if(p){let t=o.replace(/\s+/g," ").split(" ",p+1);t.length>p&&(t[p-1]+="&hellip;",t=t.slice(0,p),o=t.join(" "))}i="text",s=o}else i="name",s="(mention)";r+='<div class="webmention__content '+i+'">'+s+"</div>",r+="</div></li>"}),r+="</ul>",r}function c(t){let e='<ul class="reacts">';return t.forEach(function(t){e+='<li><div class="webmention">',e+=o(t)}),e}function l(t,e){if(window.fetch)window.fetch(t).then(function(t){return t.status>=200&&t.status<300?Promise.resolve(t):Promise.reject(new Error(t.statusText))}).then(function(t){return t.json()}).then(e).catch(function(t){console.error("Request failed",t)});else{const t=new XMLHttpRequest;t.onload=function(t){e(JSON.parse(t))},t.onerror=function(t){console.error("Request failed",t)}}}const u=t("page-url",window.location.href.replace(/#.*$/,"")),a=t("add-urls",void 0),f=t("data-id","webmentions"),p=t("wordcount"),d=t("max-webmentions",100),m=t("prevent-spoofing")?"wm-source":"url",h=t("sort-by","published"),w=t("sort-dir","up"),b={"in-reply-to":"replied","like-of":"liked","repost-of":"reposted","bookmark-of":"bookmarked","mention-of":"mentioned",rsvp:"RSVPed","follow-of":"followed"},g={"in-reply-to":"💬","like-of":"❤️","repost-of":"🔄","bookmark-of":"⭐️","mention-of":"💬",rsvp:"📅","follow-of":"🐜"},v={yes:"✅",no:"❌",interested:"💡",maybe:"💭"};window.addEventListener("load",function(){const t=document.getElementById(f);if(!t)return;const e=[r(u)];a&&a.split("|").forEach(function(t){e.push(r(t))});let o="https://webmention.io/api/mentions.jf2?per-page="+d+"&sort-by="+h+"&sort-dir="+w;e.forEach(function(t){o+="&target[]="+encodeURIComponent("http:"+t)+"&target[]="+encodeURIComponent("https:"+t)}),l(o,function(e){let o="";const n=[],r=[],l={"in-reply-to":n,"like-of":r,"repost-of":r,"bookmark-of":r,"mention-of":n,rsvp:n};e.children.forEach(function(t){const e=l[t["wm-property"]];e&&e.push(t)}),n.length>0&&(o+=s(i(n))),r.length>0&&(o+=c(i(r))),t.innerHTML=o;n.length,r.length})})})();